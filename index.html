<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Saif TV</title>
    <style>
        :root {
            --primary: #0f0f0f; --secondary: #1f1f1f;
            --text: #ffffff; --accent: #e50914; --gray: #b3b3b3;
        }
        body {
            font-family: 'Tajawal', sans-serif; margin: 0; color: var(--text);
            background-color: var(--primary); overflow-x: hidden;
        }
        /* Header */
        header { background: rgba(15,15,15,0.95); padding: 15px 5%; position: fixed; width: 90%; top: 0; z-index: 1000; backdrop-filter: blur(10px); border-bottom: 1px solid #333; display: flex; justify-content: space-between; align-items: center; }
        .logo { font-size: 2em; font-weight: 800; color: var(--accent); letter-spacing: 1px; }
        
        /* Sliders - التعديل لجعل الحركة يدوية وإخفاء شريط التمرير */
        .slider-container { width: 100%; overflow: hidden; position: relative; }
        .slider { 
            display: flex; gap: 15px; 
            overflow-x: scroll; /* لجعل السحب يدوياً */
            cursor: grab; /* مؤشر السحب */
            padding: 5px 0;
            scroll-snap-type: x mandatory; /* لتحسين تجربة التمرير */
            -webkit-overflow-scrolling: touch; /* لتحسين التمرير على iOS */
        }
        /* إخفاء شريط التمرير */
        .slider::-webkit-scrollbar { display: none; }
        .slider { -ms-overflow-style: none; scrollbar-width: none; }

        /* Top Banner - إيقاف الحركة التلقائية */
        .banner-section { margin-top: 80px; padding-bottom: 30px; } /* زيادة مسافة الفصل */
        
        /* تأثير الـ 3D والبروز */
        .banner-item { 
            min-width: 300px; height: 170px; border-radius: 10px; overflow: hidden; position: relative; 
            transition: 0.3s; cursor: pointer; 
            box-shadow: 0 4px 10px rgba(0,0,0,0.3); /* ظل خفيف دائم */
        }
        .banner-item img { width: 100%; height: 100%; object-fit: cover; }
        .banner-item:hover { 
            transform: scale(1.05); z-index: 2; 
            box-shadow: 0 15px 30px rgba(0,0,0,0.7); /* ظل بارز عند التحريك (3D) */
        }
        
        /* Categories - زيادة المسافات بين الأقسام */
        .category-section { padding: 30px 5%; margin-bottom: 20px; } /* مسافة أكبر */
        .category-title { font-size: 1.5em; margin-bottom: 15px; border-right: 4px solid var(--accent); padding-right: 10px; }
        
        /* تأثير الـ 3D والبروز على بطاقات المسلسلات */
        .series-card { 
            min-width: 160px; border-radius: 8px; overflow: hidden; cursor: pointer; 
            transition: 0.3s; position: relative; background: var(--secondary); 
            box-shadow: 0 2px 5px rgba(0,0,0,0.3); /* ظل خفيف دائم */
        }
        .series-card:hover { 
            transform: scale(1.05); 
            box-shadow: 0 10px 20px rgba(0,0,0,0.6); /* ظل بارز عند التحريك (3D) */
        }
        .series-card img { width: 100%; height: 240px; object-fit: cover; }
        .series-card .title { padding: 10px; font-size: 0.9em; text-align: center; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

        /* Fullscreen Views */
        .fullscreen-view { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 2000; background: var(--primary); transform: translateY(100%); transition: transform 0.3s ease; overflow-y: auto; }
        .fullscreen-view.active { transform: translateY(0); }
        .view-bg { position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0.3; background-size: cover; background-position: center; filter: blur(20px); z-index: -1; }
        .view-header { padding: 20px; display: flex; justify-content: flex-end; }
        .close-btn { background: rgba(255,255,255,0.1); border: none; color: white; width: 40px; height: 40px; border-radius: 50%; font-size: 1.5em; cursor: pointer; }
        .view-content { padding: 20px; max-width: 1200px; margin: 0 auto; }

        /* Episode & Details Styling */
        .info-grid { display: flex; gap: 30px; margin-bottom: 40px; flex-wrap: wrap; }
        .poster-img { width: 220px; height: 330px; border-radius: 12px; object-fit: cover; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .text-content { flex: 1; }
        .action-btn { background: var(--accent); color: white; border: none; padding: 10px 25px; border-radius: 5px; font-size: 1em; cursor: pointer; display: inline-flex; align-items: center; gap: 10px; margin-top: 15px; }
        .action-btn svg { width: 20px; height: 20px; fill: white; }
        
        .episodes-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px; }
        .episode-card { background: rgba(255,255,255,0.05); padding: 10px; border-radius: 8px; cursor: pointer; transition: 0.2s; }
        .episode-card:hover { background: rgba(255,255,255,0.1); }
        .episode-thumb { width: 100%; height: 110px; object-fit: cover; border-radius: 5px; margin-bottom: 8px; }

        .video-container { width: 100%; aspect-ratio: 16/9; background: black; border-radius: 12px; overflow: hidden; margin-bottom: 20px; }
        .video-container iframe { width: 100%; height: 100%; border: none; }

        /* Footer (Professional) */
        footer { background-color: #050505; padding: 50px 5%; margin-top: 50px; border-top: 1px solid #333; }
        .footer-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 40px; }
        .footer-col h3 { color: var(--accent); margin-bottom: 20px; font-size: 1.2em; display: flex; align-items: center; gap: 10px; }
        .footer-col h3 svg { width: 24px; height: 24px; fill: var(--accent); }
        .footer-links a { display: flex; align-items: center; gap: 10px; color: var(--gray); text-decoration: none; margin-bottom: 12px; transition: 0.3s; }
        .footer-links a svg { width: 18px; height: 18px; fill: var(--gray); transition: 0.3s; }
        .footer-links a:hover { color: white; }
        .footer-links a:hover svg { fill: var(--accent); }
        .copyright { text-align: center; color: #555; margin-top: 40px; padding-top: 20px; border-top: 1px solid #222; font-size: 0.9em; }

        @media (max-width: 768px) {
            .banner-item { min-width: 250px; height: 140px; }
            .info-grid { flex-direction: column; align-items: center; text-align: center; }
            .episodes-grid { grid-template-columns: repeat(2, 1fr); }
            .footer-grid { grid-template-columns: 1fr; text-align: center; }
            .footer-links a { justify-content: center; }
            .footer-col h3 { justify-content: center; }
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;800&display=swap" rel="stylesheet">
</head>
<body>

    <header>
        <div class="logo">Saif TV</div>
    </header>

    <!-- البانر العلوي (الآن ثابت ويتحرك بالسحب) -->
    <div class="banner-section slider-container" id="banner-container">
        <div class="slider" id="banner-content"></div>
    </div>

    <main id="main-content">
        <!-- الأقسام ستظهر هنا -->
    </main>

    <!-- Footer الاحترافي -->
    <footer>
        <div class="footer-grid">
            <div class="footer-col">
                <h3>
                    <svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-1-13h2v6h-2zm0 8h2v2h-2z"/></svg>
                    عن الموقع
                </h3>
                <p style="color: var(--gray); line-height: 1.6;">موقع سيف تي في يقدم أحدث المسلسلات بجودة عالية. نحن نسعى لتوفير تجربة مشاهدة ممتعة وسلسة لجميع المستخدمين على كافة الأجهزة.</p>
            </div>
            <div class="footer-col">
                <h3>
                    <svg viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"/></svg>
                    روابط سريعة
                </h3>
                <div class="footer-links">
                    <a href="#"><svg viewBox="0 0 24 24"><path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"/></svg> سياسة الخصوصية</a>
                    <a href="#"><svg viewBox="0 0 24 24"><path d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm-2 16l-4-4 1.41-1.41L10 14.17l6.59-6.59L18 9l-8 8z"/></svg> شروط الاستخدام</a>
                    <a href="#"><svg viewBox="0 0 24 24"><path d="M20 2H4c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-7 9h-2V5h2v6zm0 4h-2v-2h2v2z"/></svg> حقوق الملكية</a>
                </div>
            </div>
            <div class="footer-col">
                <h3>
                    <svg viewBox="0 0 24 24"><path d="M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-7 12h-2v-2h2v2zm0-4h-2V6h2v4z"/></svg>
                    تواصل معنا
                </h3>
                <div class="footer-links">
                    <a href="https://wa.me/" target="_blank">
                        <svg viewBox="0 0 24 24"><path d="M12.04 2c-5.46 0-9.91 4.45-9.91 9.91 0 1.75.46 3.45 1.32 4.95L2.05 22l5.25-1.38c1.45.79 3.08 1.2 4.74 1.2 5.46 0 9.91-4.45 9.91-9.91 0-5.46-4.45-9.91-9.91-9.91z"/></svg>
                        واتساب
                    </a>
                    <a href="#">
                        <svg viewBox="0 0 24 24"><path d="M12 2.04c-5.5 0-10 4.49-10 10.02 0 5 3.66 9.15 8.44 9.9v-7H7.9v-2.9h2.54V9.85c0-2.51 1.49-3.89 3.78-3.89 1.09 0 2.23.19 2.23.19v2.47h-1.26c-1.24 0-1.63.77-1.63 1.56v1.88h2.78l-.45 2.9h-2.33v7a10 10 0 0 0 8.44-9.9c0-5.53-4.5-10.02-10-10.02z"/></svg>
                        فيسبوك
                    </a>
                </div>
            </div>
        </div>
        <div class="copyright">© 2025 Saif TV - جميع الحقوق محفوظة</div>
    </footer>

    <!-- صفحة تفاصيل المسلسل -->
    <div class="fullscreen-view" id="details-view">
        <div class="view-bg" id="details-bg"></div>
        <div class="view-header">
            <button class="close-btn" onclick="closeView('details-view')">✕</button>
        </div>
        <div class="view-content" id="details-content"></div>
    </div>

    <!-- صفحة الحلقة -->
    <div class="fullscreen-view" id="episode-view">
        <div class="view-bg" id="episode-bg"></div>
        <div class="view-header">
            <button class="close-btn" onclick="closeView('episode-view')">✕</button>
        </div>
        <div class="view-content" id="episode-content"></div>
    </div>

    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js";
      import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-database.js";

      const firebaseConfig = { apiKey: "AIzaSyCsnZdFrg-KlWFc0z6OgmXgBp6lPKf14fU", authDomain: "saifsa-b51f1.firebaseapp.com", databaseURL: "https://saifsa-b51f1-default-rtdb.europe-west1.firebasedatabase.app", projectId: "saifsa-b51f1", storageBucket: "saifsa-b51f1.firebasestorage.app", messagingSenderId: "41089917871", appId: "1:41089917871:web:fce49f6f23bd4f679b055a" };
      const YOUTUBE_API_KEY = 'AIzaSyA4gfRf5sGQZ-a7ficcTcgU47aJV30cSgc';
      const app = initializeApp(firebaseConfig);
      const database = getDatabase(app);
      let seriesCache = {};

      // جلب البيانات
      onValue(ref(database, 'series/'), (snapshot) => {
          const data = snapshot.val() || {};
          seriesCache = data;
          
          // 1. تجميع كل المسلسلات للبانر (تلقائي)
          const allPlaylists = [];
          Object.keys(data).forEach(cat => {
              Object.values(data[cat]).forEach(item => allPlaylists.push(item.playlistId));
          });
          
          // منع التكرار في البانر
          const uniqueIds = [...new Set(allPlaylists)];
          buildBanner(uniqueIds);
          
          // 2. بناء الأقسام
          const mainContent = document.getElementById('main-content');
          mainContent.innerHTML = '';
          
          Object.keys(data).forEach(async cat => { // استخدام async
              const section = document.createElement('div');
              section.className = 'category-section';
              section.innerHTML = `<h2 class="category-title">${cat}</h2><div class="slider-container"><div class="slider" id="cat-${cat}"></div></div>`;
              mainContent.appendChild(section);
              
              const catIds = Object.values(data[cat]).map(i => i.playlistId);
              await buildSlider(document.getElementById(`cat-${cat}`), catIds);
              // تفعيل السحب اليدوي على كل قسم
              makeDraggable(document.getElementById(`cat-${cat}`)); 
          });
      });

      async function buildBanner(ids) {
          const container = document.getElementById('banner-content');
          container.innerHTML = '';
          // نأخذ آخر 10 مسلسلات فقط للبانر ليكون سريعاً
          const recentIds = ids.slice(-10); 
          
          for (const id of recentIds) {
              const info = await fetchYT(`playlists?part=snippet&id=${id}`);
              if(info && info.items.length > 0) {
                  const img = info.items[0].snippet.thumbnails.maxres?.url || info.items[0].snippet.thumbnails.high.url;
                  const div = document.createElement('div');
                  div.className = 'banner-item';
                  div.onclick = () => openSeries(id);
                  div.innerHTML = `<img src="${img}">`;
                  container.appendChild(div);
              }
          }
          // تفعيل السحب اليدوي على البانر
          if(container.children.length > 0) {
               makeDraggable(container);
          }
      }

      async function buildSlider(container, ids) {
          for (const id of ids) {
              const info = await fetchYT(`playlists?part=snippet&id=${id}`);
              if(info && info.items.length > 0) {
                  const title = info.items[0].snippet.title;
                  const img = info.items[0].snippet.thumbnails.high.url;
                  const div = document.createElement('div');
                  div.className = 'series-card';
                  div.onclick = () => openSeries(id);
                  div.innerHTML = `<img src="${img}"><div class="title">${title}</div>`;
                  container.appendChild(div);
              }
          }
      }

      async function openSeries(id) {
          const view = document.getElementById('details-view');
          const content = document.getElementById('details-content');
          content.innerHTML = '<h2 style="text-align:center">جاري التحميل...</h2>';
          view.classList.add('active');
          
          const info = await fetchYT(`playlists?part=snippet&id=${id}`);
          const items = await fetchYT(`playlistItems?part=snippet&playlistId=${id}&maxResults=50`);
          
          if(!info || !items || info.items.length === 0) {
             content.innerHTML = '<h2 style="text-align:center">عذراً، لم يتم العثور على بيانات المسلسل.</h2>';
             return;
          }
          
          const s = info.items[0].snippet;
          const bg = s.thumbnails.maxres?.url || s.thumbnails.high.url;
          document.getElementById('details-bg').style.backgroundImage = `url(${bg})`;
          
          const episodesHtml = items.items.map(e => `
              <div class="episode-card" onclick="playEpisode('${id}', '${e.snippet.resourceId.videoId}', '${e.snippet.title}')">
                  <img class="episode-thumb" src="${e.snippet.thumbnails.medium.url}">
                  <div>${e.snippet.title}</div>
              </div>
          `).join('');

          content.innerHTML = `
              <div class="info-grid">
                  <img class="poster-img" src="${s.thumbnails.high.url}">
                  <div class="text-content">
                      <h1>${s.title}</h1>
                      <p>${s.description.substring(0, 200)}${s.description.length > 200 ? '...' : ''}</p>
                      <button class="action-btn" onclick="shareLink('${id}')">
                          <svg viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92 1.61 0 2.92-1.31 2.92-2.92s-1.31-2.92-2.92-2.92z"/></svg>
                          مشاركة المسلسل
                      </button>
                  </div>
              </div>
              <h3>الحلقات (${items.items.length})</h3>
              <div class="episodes-grid">${episodesHtml}</div>
          `;
      }

      async function playEpisode(playlistId, videoId, title) {
          const view = document.getElementById('episode-view');
          const content = document.getElementById('episode-content');
          document.getElementById('details-view').classList.remove('active'); // غلق التفاصيل
          view.classList.add('active');
          
          // يمكن جلب صورة مصغرة للفيديو واستخدامها كخلفية
          // const videoInfo = await fetchYT(`videos?part=snippet&id=${videoId}`);
          // const bg = videoInfo.items[0].snippet.thumbnails.maxres?.url || videoInfo.items[0].snippet.thumbnails.high.url;
          // document.getElementById('episode-bg').style.backgroundImage = `url(${bg})`;
          
          content.innerHTML = `
              <h2>${title}</h2> <!-- عنوان الحلقة -->
              <div class="video-container">
                  <iframe src="https://www.youtube.com/embed/${videoId}?autoplay=1" allow="autoplay; fullscreen" allowfullscreen></iframe>
              </div>
              <div style="text-align:center; margin-bottom:30px;">
                 <button class="action-btn" onclick="shareLink('${playlistId}', '${videoId}')">
                    <svg viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92 1.61 0 2.92-1.31 2.92-2.92s-1.31-2.92-2.92-2.92z"/></svg>
                    مشاركة الحلقة
                 </button>
              </div>
              <h3>باقي الحلقات</h3>
              <div class="episodes-grid" id="related-eps"></div>
          `;
          
          // تحميل الحلقات المقترحة في الاسفل
          const items = await fetchYT(`playlistItems?part=snippet&playlistId=${playlistId}&maxResults=50`);
          const html = items.items.map(e => {
             const current = e.snippet.resourceId.videoId === videoId ? ' style="border: 2px solid var(--accent);"' : '';
             return `
                 <div class="episode-card" ${current} onclick="playEpisode('${playlistId}', '${e.snippet.resourceId.videoId}', '${e.snippet.title}')">
                      <img class="episode-thumb" src="${e.snippet.thumbnails.medium.url}">
                      <div>${e.snippet.title}</div>
                  </div>
              `;
          }).join('');
          document.getElementById('related-eps').innerHTML = html;
      }

      async function fetchYT(params) {
          try {
              const res = await fetch(`https://www.googleapis.com/youtube/v3/${params}&key=${YOUTUBE_API_KEY}`);
              return await res.json();
          } catch(e) { console.error("Error fetching YT data:", e); return null; }
      }

      window.closeView = (id) => {
          document.getElementById(id).classList.remove('active');
          if(id === 'episode-view') {
             // إيقاف تشغيل الفيديو عند الإغلاق
             const iframe = document.querySelector('#episode-content iframe');
             if(iframe) iframe.src = '';
          }
          // مسح الهاش عند العودة للصفحة الرئيسية
          if(window.location.hash.includes('#series=')) {
              window.history.pushState("", document.title, window.location.pathname + window.location.search);
          }
      };
      
      window.shareLink = (pid, vid) => {
          let url = `${window.location.origin}${window.location.pathname}#series=${pid}`;
          if(vid) url += `&vid=${vid}`;
          navigator.clipboard.writeText(url).then(() => alert('تم نسخ الرابط بنجاح! يمكن الآن مشاركته مباشرة.'));
      }
      
      // فتح الروابط المباشرة (Deep Linking)
      window.onload = () => {
          const hash = window.location.hash;
          if(hash.includes('series=')) {
              const pid = hash.split('series=')[1].split('&')[0];
              const vid = hash.includes('vid=') ? hash.split('vid=')[1].split('&')[0] : null;
              if(vid) {
                 // يجب جلب عنوان الحلقة لتمريره
                 // هذا يتطلب طلب إضافي، ولتسهيل الأمر، سنقوم فقط بالتشغيل
                 playEpisode(pid, vid, 'جاري تحميل العنوان...');
              }
              else openSeries(pid);
          }
      }
      
      // كود تفعيل السحب اليدوي (Drag/Swipe)
      window.makeDraggable = (slider) => {
        let isDown = false;
        let startX;
        let scrollLeft;

        const startDrag = (e) => {
            isDown = true;
            slider.style.cursor = 'grabbing';
            const clientX = e.touches ? e.touches[0].pageX : e.pageX;
            startX = clientX - slider.offsetLeft;
            scrollLeft = slider.scrollLeft;
        };

        const endDrag = () => {
            isDown = false;
            slider.style.cursor = 'grab';
        };

        const moveDrag = (e) => {
            if(!isDown) return;
            e.preventDefault();
            const clientX = e.touches ? e.touches[0].pageX : e.pageX;
            const x = clientX - slider.offsetLeft;
            const walk = (x - startX) * 2; // تحريك أسرع
            slider.scrollLeft = scrollLeft - walk;
        };

        // أحداث الفأرة
        slider.addEventListener('mousedown', startDrag);
        slider.addEventListener('mouseleave', endDrag);
        slider.addEventListener('mouseup', endDrag);
        slider.addEventListener('mousemove', moveDrag);
        
        // أحداث اللمس (موبايل)
        slider.addEventListener('touchstart', startDrag, { passive: true });
        slider.addEventListener('touchend', endDrag);
        slider.addEventListener('touchmove', moveDrag, { passive: false });
      };
    </script>
</body>
</html>
